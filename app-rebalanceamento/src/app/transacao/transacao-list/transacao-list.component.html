<select name="tipoPeriodo" [(ngModel)]="visao">
    <option [value]="tipo" *ngFor="let tipo of tiposPeriodo">{{tipo}}</option>
</select>

<table *ngIf="!!matriz" class="table">
    <thead>
        <tr>
            <td>Transação</td>
            <td>Dia Venc.</td>
            <td *ngFor="let periodo of periodos" [style.font-weight]="periodo === periodoCorrente ? 'bold' : null" >
                {{periodo}}
            </td>
            <td>Total</td>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let classe of classesTransacao">
            <td>
                {{classe}}
            </td>
            <td>{{diaInicial(classe)}}</td>
            <td *ngFor="let periodo of periodos">

                <div *ngIf="!! matriz[classe][periodo]; else TransacaoUndefined" class=" text-end">
                    <ng-container *ngIf="matriz[classe][periodo]?.unico">
                        U
                        <ng-container
                            [ngTemplateOutlet]="lancamentoUnico" 
                            [ngTemplateOutletContext]="{periodo,classe,lancamento:matriz[classe][periodo]}">
                        </ng-container>
                    </ng-container>
                    <ng-container *ngIf="! matriz[classe][periodo]?.unico">
                        M
                        <ng-container
                            [ngTemplateOutlet]="lancamentosMultiplos" 
                            [ngTemplateOutletContext]="{periodo,classe,lancamentos:matriz[classe][periodo]}">
                        </ng-container>
                    </ng-container>
                    <!-- <ng-container 
                        [ngTemplateOutlet]="lancamentos[classe][periodo]?._id ? textPagto : criarPagto" 
                        [ngTemplateOutletContext]="{mes,despesa:lancamentos[classe][mes],name:'pagto_'+mes+'_'+(lancamentos[classe][mes]?._id || 0)}">
                    </ng-container> -->
                </div>
            </td>
            <td class="text-end">
                {{totaisClasse[classe] | number:'1.2-2'}}
            </td>
        </tr>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="2">Totais:</td>
            <td class="text-end" *ngFor="let periodo of periodos">{{totaisMes[periodo] | number:'1.2-2'}}</td>
            <td class="text-end">{{totais | number:'1.2-2'}}</td>
        </tr>
    </tfoot>
</table>

<pre>{{ matriz | json }}</pre>
<a (click)="criarTransacao()" href="javascript:void(0)">Criar Transação</a>
|
<a routerLink="/despesas/lancamentos">Pagamentos</a>

<ng-template #textPagto let-periodo="periodo" let-lancamentos="lancamentos" let-classe>
    <!-- <a [routerLink]="['/despesas/edit/', lancamento._id]" class="lancamento-valor pago"> -->
    <a href="javascript:void(0)" (click)="editarTransacao(lancamentos, 'Edição Transação')" class="transacao-valor" 
        [ngClass]="classeLancamento(lancamentos.transacoes[0])">
        {{ lancamentos.total | number : '1.2-2' }}
    </a>
</ng-template>

<ng-template #lancamentoUnico let-periodo="periodo" let-lancamento="lancamento" let-classe="classe">
    <a href="javascript:void(0)" (click)="editarTransacao(lancamento.transacoes[0], 'Edição Transação')" class="transacao-valor" 
    [ngClass]="classeLancamento(lancamento?.transacoes[0])">
    {{ lancamento.total | number : '1.2-2' }}
</a>
</ng-template>

<ng-template #lancamentosMultiplos let-periodo="periodo" let-total let-lancamentos="lancamentos" let-classe>
    <a href="javascript:void(0)" (click)="abrirPopupTransacoes(lancamentos.transacoes, $event)" class="multiplos-lancamentos">
        {{ lancamentos.total | number : '1.2-2' }}
    </a>
    
</ng-template>

<app-popup-menu [width]="'300px'">
    <h6 class="title border-bottom">Escolha uma opção</h6>
    <div class="items">
      <a class="popup-item nowrap" *ngFor="let transacao of popupTransacoes" (click)="editarTransacao(transacao, 'Editar transação')">
        {{transacao.descricao}} - {{transacao.tipoTransacao}} - {{transacao.valor}}
      </a>
    </div>
</app-popup-menu>

<ng-template #criarPagto let-periodo="periodo" let-lancamento="lancamento">
    <a href="javascript:void(0)" (click)="editarTransacao(lancamento, 'Cadastro transação')" class="transacao-valor">
        {{ lancamento.valor | number : '1.2-2' }}
    </a>
</ng-template>

<ng-template #TransacaoUndefined >
    <div class="text-end">-</div>
</ng-template>